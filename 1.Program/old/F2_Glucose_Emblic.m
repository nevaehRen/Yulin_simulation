clear;
clc;

Params = Params_HOMAa();


Params.injection_speed=[0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,250,255,260,265,270,275,280,285,290,295,300,305,310,315,320,325,330,335,340,345,350,355,360,365,370,375,380,385,390,395,400,405,410,415,420,425,430,435,440,445,450,455,460,465,470,475,480,485,490,495,500,505,510,515,520,525,530,535,540,545,550,555,560,565,570,575,580,585,590,595,600,605,610,615,620,625,630,635,640,645,650,655,660,665,670,675;0,2,2,2,2,2,2,4,4,4,4,4,4,6,6,6,6,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,6,6,6,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
%% bodyweight
Params.BodyWeight=260;
%% solution concentration, blood volumn, and decay speed
Params.solution_insulin_concentration=0.3*7e6;
Params.Blood_Volumn = 0.074*Params.BodyWeight*1e-3;
Params.tau =  0.1;


INIt=[28 0 72];

[Time,sol] = ode15s('Glucose',[0:500],INIt, [], Params);

% 
% % - % - % - % - % - % - % - % - %
% %-----   Time Series Plot  -----%
% % - % - % - % - % - % - % - % - %
% close;
figure(1)
set(gcf,'Position',[30   186  630 600], 'color','w');

subplot(3,1,1)
hold on
plot(Time,sol(:,1),'r','Linewidth',3);
xlabel('t(min)');
ylabel('BG(mmol)');

subplot(3,1,2)
hold on
plot(Time,sol(:,2),'r','Linewidth',3);
xlabel('t(min)');
ylabel('BI(pmol/L)');

subplot(3,1,3)
plot(Time,sol(:,3),'r','Linewidth',3);
xlabel('t(min)');
ylabel('GL(pmol/L)');



figure(1);
subplot(3,1,1)
%%%--Durian--%%%
BI_real=[0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,250,255,260,265,270,275,280,285,290,295,300,305,310,315,320,325,330,335,340,345,350,355,360,365,370,375,380,385,390,395,400,405,410,415,420,425,430,435,440,445,450,455,460,465,470,475,480,485,490,495,500,505,510,515,520,525,530,535,540,545,550,555,560,565,570,575,580,585,590,595,600,605,610,615,620,625,630,635,640,645,650,655,660,665,670,675;0,2,2,2,2,2,2,4,4,4,4,4,4,6,6,6,6,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,6,6,6,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;27,28.8000000000000,27.6000000000000,26.8000000000000,28.2000000000000,27.9000000000000,26.5000000000000,26.9000000000000,25.6000000000000,26.2000000000000,24.1000000000000,23.4000000000000,22.7000000000000,23,21.8000000000000,21.5000000000000,18.6000000000000,17,13.5000000000000,11.2000000000000,9.20000000000000,6.90000000000000,7,6.90000000000000,3.90000000000000,3.90000000000000,3.70000000000000,4.30000000000000,4.60000000000000,5.20000000000000,3.80000000000000,3.60000000000000,3.20000000000000,3.70000000000000,4.70000000000000,3.30000000000000,4.70000000000000,3.20000000000000,3.20000000000000,3.20000000000000,3.50000000000000,2.70000000000000,3.50000000000000,3.20000000000000,3.10000000000000,3.60000000000000,3.90000000000000,3.20000000000000,3.60000000000000,3.80000000000000,3.20000000000000,3.90000000000000,3.90000000000000,3.40000000000000,3.90000000000000,4.20000000000000,3.60000000000000,4.30000000000000,4.80000000000000,5.30000000000000,5.80000000000000,6.10000000000000,5.90000000000000,7.50000000000000,6.30000000000000,6.50000000000000,6.80000000000000,7.60000000000000,7.90000000000000,8.20000000000000,8.30000000000000,7.50000000000000,8.70000000000000,7.80000000000000,8,9.50000000000000,8.70000000000000,8.50000000000000,8.50000000000000,9.30000000000000,8.70000000000000,9.90000000000000,9.20000000000000,10.1000000000000,9,9.40000000000000,10.5000000000000,10.2000000000000,10.4000000000000,10.6000000000000,10.5000000000000,10.8000000000000,11.8000000000000,12.5000000000000,12.2000000000000,16.6000000000000,13.1000000000000,12.2000000000000,14.5000000000000,13.2000000000000,13.7000000000000,15.3000000000000,14.8000000000000,16.3000000000000,15.6000000000000,15.4000000000000,16.4000000000000,16,16.6000000000000,16.3000000000000,17.5000000000000,16.8000000000000,15.9000000000000,17.6000000000000,18,16.8000000000000,16.9000000000000,17,16.4000000000000,19.1000000000000,18.2000000000000,19,18.7000000000000,19.7000000000000,19.3000000000000,23.4000000000000,19.8000000000000,21.8000000000000,23.6000000000000,22.9000000000000,26.2000000000000,23.8000000000000,24.2000000000000,22.6000000000000,22.4000000000000,23.1000000000000]';
plot(BI_real(:,1),BI_real(:,3),'--','color',[0 0.5 0],'linewidth',2,'marker','.','markersize',10)
%  plot(BI_real(:,2),BI_real(:,1),'--','color',[0 0.5 0],'linewidth',2,'marker','.','markersize',15)

subplot(3,1,2)
BI_real=[7.78957000000000,15.2930300000000,59.6841100000000,515.860240000000,725.547080000000,1142.94536000000,1202.22623000000,1424.45499000000,1688.00769000000,2033.91094000000,1987.39826000000,2006.47872000000,2020.98278000000,1661.92459000000,1258.59041000000,822.763450000000,712.756960000000,614.048500000000,575.816520000000,277.151680000000,199.450970000000,95.8264500000000,30.2112100000000,15.2930300000000,15.2930300000000,7.78957000000000,0.256870000000000,-7.30473000000000,-22.5131000000000,-14.8948900000000,37.6252500000000,-22.5131000000000,-22.5131000000000,-7.30473000000000,15.2930300000000,0.256870000000000,-22.5131000000000,-30.1591900000000,-22.5131000000000,-22.5131000000000,-22.5131000000000,-7.30473000000000,7.78957000000000,-14.8948900000000,-22.5131000000000,-22.5131000000000;0,15,30,45,60,75,90,105,120,135,150,165,180,195,210,225,240,255,270,285,300,315,330,345,360,375,390,405,420,435,450,465,480,495,510,525,540,555,570,585,600,615,630,645,660,675]';%%%--Emblic--%%%
plot(BI_real(:,2),BI_real(:,1),'--','color',[0 0.5 0],'linewidth',2,'marker','.','markersize',10)




